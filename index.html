<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>ğŸ¼ ãƒ‘ãƒ³ãƒ€ãƒ­ã‚¤ãƒ¤ãƒ« â€“ 10 Rounds</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <link
      rel="apple-touch-icon"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ¼</text></svg>"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg: #f7f8fa;
        --card: #ffffff;
        --accent: #24b39c;
        --accent-d: #1b8976;
        --border: #e0e0e0;
        --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);

        --yellow: #ffe066;
        --purple: #c1a5ff;
        --red: #ff8d8d;
        --green: #87e293;
        --blue: #74c0fc;
        --pink: #ff99c8;
        --rainbow: linear-gradient(135deg, #ff6b6b, #ffd43b, #8ce99a, #74c0fc, #b197fc, #ff99c8);
      }
      * {
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }
      body {
        margin: 0;
        font-family: "Poppins", sans-serif;
        background: var(--bg);
        color: #333;
        padding-bottom: env(safe-area-inset-bottom);
      }
      header {
        background: var(--accent);
        color: #fff;
        text-align: center;
        padding: 1rem 2rem;
        padding-top: calc(1rem + env(safe-area-inset-top));
        box-shadow: var(--shadow);
      }
      .container {
        max-width: 960px;
        margin: 1.5rem auto;
        padding: 0 1rem;
      }
      .card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: var(--shadow);
        margin-bottom: 1.5rem;
      }

      /* buttons */
      .btn {
        width: 100%;
        border: none;
        border-radius: 10px;
        padding: 0.9rem 1rem;
        font-size: 1.05rem;
        font-weight: 600;
        color: #fff;
        background: var(--accent);
        cursor: pointer;
        transition: background 0.2s;
        touch-action: manipulation;
        min-height: 48px;
      }
      .btn:hover:not(:disabled) {
        background: var(--accent-d);
      }
      .btn:active:not(:disabled) {
        background: var(--accent-d);
        transform: scale(0.97);
      }
      .btn:disabled {
        opacity: 0.55;
        cursor: not-allowed;
      }
      .btn-secondary {
        background: #868e96;
      }
      .btn-secondary:hover:not(:disabled),
      .btn-secondary:active:not(:disabled) {
        background: #495057;
      }

      /* inputs */
      .input {
        width: 100%;
        border: 2px solid var(--border);
        border-radius: 10px;
        padding: 0.8rem 1rem;
        font-size: 1.05rem;
        font-family: "Poppins", sans-serif;
        outline: none;
        transition: border-color 0.2s;
        min-height: 48px;
      }
      .input:focus {
        border-color: var(--accent);
      }

      /* room code display */
      .room-code {
        font-size: 2.5rem;
        font-weight: 700;
        letter-spacing: 0.3em;
        color: var(--accent);
        text-align: center;
        margin: 1rem 0;
        font-family: monospace;
      }

      /* connection status dot */
      .status-dot {
        display: inline-block;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        margin-right: 6px;
      }
      .status-dot.connected {
        background: #51cf66;
      }
      .status-dot.waiting {
        background: #ffd43b;
        animation: pulse 1.5s infinite;
      }
      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.4;
        }
      }

      /* sparkle animation */
      @keyframes sparkle {
        0% {
          box-shadow: 0 0 8px 4px rgba(255, 215, 0, 0.9);
        }
        25% {
          box-shadow: 0 0 16px 8px rgba(255, 235, 150, 0.8);
        }
        50% {
          box-shadow: 0 0 24px 12px rgba(255, 245, 200, 0.6);
        }
        75% {
          box-shadow: 0 0 16px 8px rgba(255, 235, 150, 0.8);
        }
        100% {
          box-shadow: 0 0 8px 4px rgba(255, 215, 0, 0.9);
        }
      }

      /* offer buttons */
      #offers {
        display: flex;
        gap: 0.75rem;
        flex-wrap: wrap;
        justify-content: center;
      }
      .offer-btn {
        flex: 1 1 140px;
        min-width: 140px;
        padding: 0.9rem 1rem;
        font-weight: 600;
        border: none;
        border-radius: 12px;
        color: #333;
        box-shadow: var(--shadow);
        cursor: pointer;
        transition:
          transform 0.15s,
          filter 0.15s;
        touch-action: manipulation;
        min-height: 48px;
      }
      .offer-btn:hover:not(:disabled) {
        transform: translateY(-4px);
        filter: brightness(1.05);
      }
      .offer-btn:active:not(:disabled) {
        transform: scale(0.95);
      }
      .offer-btn:disabled {
        opacity: 0.55;
        cursor: not-allowed;
      }
      .offer-yellow {
        background: var(--yellow);
      }
      .offer-purple {
        background: var(--purple);
      }
      .offer-red {
        background: var(--red);
      }
      .offer-green {
        background: var(--green);
      }
      .offer-blue {
        background: var(--blue);
      }
      .offer-pink {
        background: var(--pink);
      }
      .offer-rainbow {
        background: linear-gradient(135deg, #ff6b6b, #ffd43b, #8ce99a, #74c0fc, #b197fc, #ff99c8);
        color: #fff;
        text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        position: relative;
        animation: sparkle 0.8s infinite alternate ease-in-out;
      }

      /* star elements */
      .star {
        position: absolute;
        font-size: 1.2em;
        color: #fff;
        animation: star 1.5s infinite ease-in-out;
        pointer-events: none;
      }
      @keyframes star {
        0%,
        100% {
          opacity: 0;
        }
        50% {
          opacity: 1;
        }
      }

      /* table */
      .table-wrap {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        min-width: 640px;
      }
      th,
      td {
        border: 1px solid var(--border);
        padding: 0.4rem 0.3rem;
        text-align: center;
        white-space: nowrap;
      }
      th {
        background: #fafafa;
      }
      tbody tr:nth-child(odd) {
        background: #fdfdfd;
      }
      tbody tr:nth-child(even) {
        background: #f7f7f7;
      }
      /* åˆè¨ˆåˆ— */
      .total-cell {
        font-weight: 700;
        font-size: 1.1em;
        color: var(--accent-d);
        background: #e6f9f5 !important;
      }
      /* ãƒ€ã‚¤ã‚¹ãƒãƒƒã‚¸ */
      .dice-badges {
        display: flex;
        gap: 3px;
        flex-wrap: wrap;
        justify-content: center;
      }
      .dice-badge {
        display: inline-block;
        padding: 2px 6px;
        border-radius: 6px;
        font-size: 0.78rem;
        font-weight: 600;
        color: #333;
        line-height: 1.3;
      }
      /* ãƒ©ã‚¦ãƒ³ãƒ‰ã®ãƒˆãƒƒãƒ—ã‚¹ã‚³ã‚¢ */
      .top-score {
        color: var(--accent-d);
        font-weight: 700;
      }
      /* ãƒ­ãƒ¼ãƒ«ã‚¢ãƒ‹ãƒ¡ */
      @keyframes shake {
        0%,
        100% {
          transform: rotate(0deg);
        }
        20% {
          transform: rotate(-8deg);
        }
        40% {
          transform: rotate(8deg);
        }
        60% {
          transform: rotate(-5deg);
        }
        80% {
          transform: rotate(5deg);
        }
      }
      .rolling {
        animation: shake 0.4s ease-in-out;
      }
      /* æœ€çµ‚ãƒ©ã‚¦ãƒ³ãƒ‰åˆ— */
      .final-round-header {
        background: #fff3e0 !important;
        color: #e65100;
        font-weight: 700;
      }
      .final-round-cell {
        background: #fff8e1 !important;
        font-weight: 700;
        font-size: 1.05em;
      }
      .final-round-cell.top-score {
        background: #ffe0b2 !important;
        color: #e65100;
      }

      /* player list in lobby */
      .player-list {
        list-style: none;
        padding: 0;
        margin: 0.5rem 0;
      }
      .player-list li {
        padding: 0.5rem 0.8rem;
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      .player-list li:last-child {
        border-bottom: none;
      }

      /* hidden helper */
      .hidden {
        display: none !important;
      }

      /* Scene transition */
      .scene {
        display: none;
      }
      .scene.active {
        display: block;
      }

      @media (max-width: 600px) {
        header h1 {
          font-size: 1.2rem;
        }
        .room-code {
          font-size: 2rem;
        }
        .container {
          padding: 0 0.5rem;
        }
        .card {
          padding: 1rem;
        }
        table {
          font-size: 0.8rem;
        }
      }
    </style>
  </head>
  <body>
    <header><h1>ğŸ¼ ãƒ‘ãƒ³ãƒ€ãƒ­ã‚¤ãƒ¤ãƒ« â€“ 10 Rounds</h1></header>
    <div class="container">
      <!-- ===== SCENE: ãƒ­ãƒ“ãƒ¼ (ãƒ›ã‚¹ãƒˆ/ã‚²ã‚¹ãƒˆé¸æŠ) ===== -->
      <div id="sceneLobby" class="scene active">
        <div class="card" style="text-align: center">
          <h2 style="margin-top: 0">ğŸ¼ ã‚ˆã†ã“ãï¼</h2>
          <div style="margin-bottom: 1rem">
            <input
              id="nameInput"
              class="input"
              type="text"
              placeholder="åå‰ã‚’å…¥åŠ›"
              maxlength="12"
              autocomplete="off"
              style="text-align: center"
            />
          </div>
          <div style="display: flex; flex-direction: column; gap: 0.8rem">
            <button id="hostBtn" class="btn">ãƒ›ã‚¹ãƒˆã§éƒ¨å±‹ã‚’ä½œã‚‹</button>
            <button id="joinBtn" class="btn btn-secondary">
              éƒ¨å±‹ã«å‚åŠ ã™ã‚‹
            </button>
          </div>
        </div>
      </div>

      <!-- ===== SCENE: ãƒ›ã‚¹ãƒˆå¾…æ©Ÿ ===== -->
      <div id="sceneHostWait" class="scene">
        <div class="card" style="text-align: center">
          <h2 style="margin-top: 0">ğŸ“¡ æ¥ç¶šå¾…ã¡</h2>
          <p>ã“ã®ãƒ«ãƒ¼ãƒ ã‚³ãƒ¼ãƒ‰ã‚’å‚åŠ è€…ã«ä¼ãˆã¦ãã ã•ã„ï¼š</p>
          <div
            id="roomCodeDisplay"
            class="room-code"
            title="ã‚¿ãƒƒãƒ—ã§ã‚³ãƒ”ãƒ¼"
            style="cursor: pointer"
          >
            ----
          </div>
          <p
            id="copyMsg"
            style="
              font-size: 0.85rem;
              color: var(--accent);
              opacity: 0;
              transition: opacity 0.3s;
            "
          >
            ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼
          </p>
          <p>
            <span class="status-dot waiting"></span
            >ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ¥ç¶šã‚’å¾…ã£ã¦ã„ã¾ã™â€¦
          </p>
          <ul id="playerList" class="player-list"></ul>
          <button id="startBtn" class="btn" disabled>ã‚²ãƒ¼ãƒ é–‹å§‹</button>
        </div>
      </div>

      <!-- ===== SCENE: ã‚²ã‚¹ãƒˆæ¥ç¶š ===== -->
      <div id="sceneGuestJoin" class="scene">
        <div class="card" style="text-align: center">
          <h2 style="margin-top: 0">ğŸ”— éƒ¨å±‹ã«å‚åŠ </h2>
          <p>ãƒ›ã‚¹ãƒˆã®ãƒ«ãƒ¼ãƒ ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ï¼š</p>
          <input
            id="codeInput"
            class="input"
            type="tel"
            inputmode="numeric"
            pattern="[0-9]*"
            placeholder="4æ¡ã®æ•°å­—"
            maxlength="4"
            autocomplete="off"
            style="
              text-align: center;
              letter-spacing: 0.3em;
              font-size: 1.5rem;
              font-family: monospace;
            "
          />
          <div style="margin-top: 1rem">
            <button id="connectBtn" class="btn">æ¥ç¶šã™ã‚‹</button>
          </div>
          <p id="connectStatus" style="margin-top: 0.5rem; color: #868e96"></p>
          <button
            id="backBtn"
            class="btn btn-secondary"
            style="margin-top: 0.5rem"
          >
            æˆ»ã‚‹
          </button>
        </div>
      </div>

      <!-- ===== SCENE: ã‚²ãƒ¼ãƒ  ===== -->
      <div id="sceneGame" class="scene">
        <!-- Controls -->
        <div
          class="card"
          style="
            display: flex;
            flex-direction: column;
            gap: 1rem;
            align-items: center;
          "
        >
          <h2
            id="winner"
            class="hidden"
            style="color: var(--accent); margin: 0"
          ></h2>
          <p
            id="eventBanner"
            class="hidden"
            style="
              margin: 0;
              padding: 8px 12px;
              font-weight: 700;
              font-size: 1.1rem;
              color: #fff;
              border-radius: 8px;
              text-align: center;
              width: 100%;
            "
          ></p>
          <p
            id="roundLabel"
            style="
              margin: 0;
              font-size: 1.3rem;
              font-weight: 700;
              color: var(--accent);
            "
          ></p>
          <button id="rollBtn" class="btn">ğŸ² ãƒ€ã‚¤ã‚¹ã‚’æŒ¯ã‚‹ï¼</button>
          <button id="rematchBtn" class="btn hidden">å†æˆ¦ï¼</button>
          <p id="waiting" style="margin: 0; font-weight: 600"></p>
          <p id="info" style="margin: 0; font-size: 1.1rem"></p>
        </div>

        <!-- Offers -->
        <div id="offersCard" class="card hidden">
          <h3 style="margin-top: 0">ğŸ ç²å¾—ã§ãã‚‹ãƒ€ã‚¤ã‚¹</h3>
          <div id="offers"></div>
        </div>

        <!-- Scoreboard + Dice Result -->
        <div class="card">
          <h3 style="margin-top: 0">ğŸ“Š ã‚¹ã‚³ã‚¢ãƒœãƒ¼ãƒ‰</h3>
          <p style="margin: 0 0 0.5rem; font-size: 0.85rem; color: #868e96">
            â„¹ï¸ R1ï½9 ã¯æº–å‚™æœŸé–“ã€‚æœ€çµ‚ãƒ©ã‚¦ãƒ³ãƒ‰ (R10) ã®å¾—ç‚¹ã§å‹æ•—ãŒæ±ºã¾ã‚Šã¾ã™ï¼
          </p>
          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</th>
                  <th>1</th>
                  <th>2</th>
                  <th>3</th>
                  <th>4</th>
                  <th>5</th>
                  <th>6</th>
                  <th>7</th>
                  <th>8</th>
                  <th>9</th>
                  <th class="final-round-header">ğŸ”¥ 10</th>
                  <th>åˆè¨ˆ</th>
                  <th>æ‰‹æŒã¡ãƒ€ã‚¤ã‚¹</th>
                </tr>
              </thead>
              <tbody id="scoreBody"></tbody>
            </table>
          </div>
          <div id="detail" style="margin-top: 1.5rem">
            <h3 style="margin-top: 0">ğŸ² ãƒ€ã‚¤ã‚¹çµæœ</h3>
            <p>â€”</p>
          </div>
        </div>

        <!-- Dice Effects -->
        <div class="card">
          <h3 style="margin-top: 0">ğŸ“ ãƒ€ã‚¤ã‚¹åŠ¹æœ</h3>
          <div id="diceHelp"></div>
        </div>

        <!-- Event List -->
        <div class="card">
          <h3 style="margin-top: 0">ğŸ” ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§</h3>
          <ul id="eventList" style="margin: 0 1rem"></ul>
        </div>

        <!-- Reset -->
        <div style="text-align: center; margin: 2rem 0">
          <button
            id="resetBtn"
            class="btn btn-secondary"
            style="max-width: 300px"
          >
            ã‚²ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
          </button>
        </div>
      </div>

      <!-- ===== æ¥ç¶šåˆ‡æ–­é€šçŸ¥ ===== -->
      <div
        id="disconnectOverlay"
        class="hidden"
        style="
          position: fixed;
          inset: 0;
          background: rgba(0, 0, 0, 0.6);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 9999;
        "
      >
        <div class="card" style="max-width: 360px; text-align: center">
          <h2 style="margin-top: 0; color: #fa5252">âš ï¸ æ¥ç¶šãŒåˆ‡ã‚Œã¾ã—ãŸ</h2>
          <p>ãƒ›ã‚¹ãƒˆã¨ã®æ¥ç¶šãŒå¤±ã‚ã‚Œã¾ã—ãŸã€‚</p>
          <button onclick="location.reload()" class="btn">ãƒˆãƒƒãƒ—ã«æˆ»ã‚‹</button>
        </div>
      </div>
    </div>
    <script type="module" src="/src/main.js"></script>
  </body>
</html>
